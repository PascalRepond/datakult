{% load i18n %}
{% load media_tags %}
{# This partial renders only the media items without the container #}
{% if view_mode == 'grid' %}
  {# Grid view - Cards #}
  {% for media in media_list %}
    <div class="card bg-base-200 shadow-sm">
      <figure class="relative w-full h-64 bg-base-300">
        <a href="{% url 'media_detail' media.pk %}"
           class="w-full h-full flex items-center justify-center hover:opacity-90 transition-opacity">
          {% if media.cover %}
            <img src="{{ media.cover.url }}"
                 alt="{% translate "Cover of" %} {{ media.title }}"
                 class="w-full h-full object-contain">
          {% else %}
            <div class="w-full h-full flex items-center justify-center text-base-content/30">
              {% lucide "image" class="w-24 h-24" %}
            </div>
          {% endif %}
        </a>
        <div class="absolute top-2 left-2 pointer-events-none">
          <span class="badge badge-neutral badge-lg"
                aria-label="{{ media.get_media_type_display }}">{% media_icon media.media_type size="md" %}</span>
        </div>
      </figure>
      <div class="card-body p-3">
        <div class="flex justify-between gap-2">
          <div>
            <a href="{% url 'media_detail' media.pk %}" class="hover:underline">
              <h3 class="card-title inline">{{ media.title }}</h3>
            </a>
            {% if media.pub_year %}<span class="opacity-70">({{ media.pub_year }})</span>{% endif %}
            <div>{% include "partials/media_items/media_contributors.html" %}</div>
          </div>
          {% include "partials/media_items/media_edit_button.html" %}
        </div>
        {% include "partials/media_items/media_status_badge.html" %}
        {% if media.score %}
          <div class="mt-2">
            {% include "partials/media_items/score/media_score_stars.html" with size="sm" show_badge=False %}
          </div>
          {% include "partials/media_items/score/media_score_badge.html" %}
        {% endif %}
        {% if media.review %}
          <div id="review-cell-{{ media.id }}" class="text-sm review-text">
            {% include "partials/media_items/media_review_clamped.html" %}
          </div>
        {% endif %}
      </div>
    </div>
  {% endfor %}
{% else %}
  {# List view - Table rows #}
  {% for media in media_list %}
    <tr>
      {# Cover with media type badge #}
      <td class="align-top p-2">
        <a href="{% url 'media_detail' media.pk %}">{% include "partials/media_items/media_cover.html" %}</a>
      </td>
      {# Title, contributors #}
      <td class="align-top p-2">
        <div class="flex flex-col gap-1">
          <div class="flex items-start gap-2 justify-between">
            <a href="{% url 'media_detail' media.pk %}" class="hover:underline">
              <h3 class="font-bold text-base">
                {{ media.title }}
                {% if media.pub_year %}<span class="opacity-70 text-sm font-normal">({{ media.pub_year }})</span>{% endif %}
              </h3>
            </a>
          </div>
          {% if media.contributors.all %}
            <div class="text-sm opacity-70">{% include "partials/media_items/media_contributors.html" %}</div>
          {% endif %}
          {# Show badge on small screens only (hidden from md+) #}
          {% if media.score %}
            <div class="md:hidden shrink-0">{% include "partials/media_items/score/media_score_badge.html" with size="sm" %}</div>
          {% endif %}
        </div>
      </td>
      {# Review #}
      <td class="align-top p-2 hidden md:table-cell">
        {% if media.score %}
          {# Show only badge on medium screens, stars + badge on large screens #}
          <div class="mb-2 hidden xl:block">
            {% include "partials/media_items/score/media_score_stars.html" with size="sm" %}
          </div>
          <div class="mb-2 xl:hidden">{% include "partials/media_items/score/media_score_badge.html" with size="sm" %}</div>
        {% endif %}
        {% if media.review %}
          <div id="review-cell-{{ media.id }}" class="text-sm max-w-200 review-text">
            {% include "partials/media_items/media_review_clamped.html" %}
          </div>
        {% endif %}
      </td>
      {# Status #}
      <td class="align-top p-2 hidden sm:table-cell">{% include "partials/media_items/media_status_badge.html" %}</td>
      {# Review date #}
      <td class="align-top p-2 hidden lg:table-cell">
        {% if media.review_date %}
          <span class="text-sm">{{ media.review_date }}</span>
        {% else %}
          <span class="text-sm opacity-50">â€”</span>
        {% endif %}
      </td>
      {# Actions #}
      <td class="align-top p-2">{% include "partials/media_items/media_edit_button.html" %}</td>
    </tr>
  {% endfor %}
{% endif %}
