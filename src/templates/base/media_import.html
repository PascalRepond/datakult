{% extends "base/base.html" %}
{% load i18n %}
{% block title %}
  {% translate "Import metadata" %} - Datakult
{% endblock title %}
{% block content %}
  <div class="max-w-2xl mx-auto">
    {# Header #}
    <div class="flex items-center gap-4 mb-6">
      {% include "partials/common/back_button.html" %}
      <h1 class="text-4xl font-bold">{% translate "Import metadata" %}</h1>
    </div>
    {# Source selector tabs #}
    <div class="tabs tabs-box mb-6">
      <input type="radio"
             name="import_source"
             class="tab"
             aria-label="{% translate 'Movies & TV' %}"
             id="tab-tmdb"
             checked
             autocomplete="off"
             hx-on:click="document.getElementById('source-tmdb').classList.remove('hidden'); document.getElementById('source-igdb').classList.add('hidden'); document.getElementById('source-openlibrary').classList.add('hidden'); document.getElementById('source-musicbrainz').classList.add('hidden'); document.getElementById('import-results').innerHTML='';">
      <input type="radio"
             name="import_source"
             class="tab"
             aria-label="{% translate 'Video games' %}"
             id="tab-igdb"
             autocomplete="off"
             hx-on:click="document.getElementById('source-igdb').classList.remove('hidden'); document.getElementById('source-tmdb').classList.add('hidden'); document.getElementById('source-openlibrary').classList.add('hidden'); document.getElementById('source-musicbrainz').classList.add('hidden'); document.getElementById('import-results').innerHTML='';">
      <input type="radio"
             name="import_source"
             class="tab"
             aria-label="{% translate 'Books' %}"
             id="tab-openlibrary"
             autocomplete="off"
             hx-on:click="document.getElementById('source-openlibrary').classList.remove('hidden'); document.getElementById('source-tmdb').classList.add('hidden'); document.getElementById('source-igdb').classList.add('hidden'); document.getElementById('source-musicbrainz').classList.add('hidden'); document.getElementById('import-results').innerHTML='';">
      <input type="radio"
             name="import_source"
             class="tab"
             aria-label="{% translate 'Music' %}"
             id="tab-musicbrainz"
             autocomplete="off"
             hx-on:click="document.getElementById('source-musicbrainz').classList.remove('hidden'); document.getElementById('source-tmdb').classList.add('hidden'); document.getElementById('source-igdb').classList.add('hidden'); document.getElementById('source-openlibrary').classList.add('hidden'); document.getElementById('import-results').innerHTML='';">
    </div>
    {# TMDB Search (Movies & TV) #}
    <div id="source-tmdb" class="card bg-base-200 shadow-md mb-6">
      <div class="card-body p-4 space-y-3">
        <div class="flex items-center gap-2 mb-2">
          {% lucide "film" class="w-5 h-5" %}
          <span class="font-semibold">TMDB</span>
          <span class="text-sm opacity-70">- {% translate "Movies & TV" %}</span>
        </div>
        <div class="join w-full">
          <input type="text"
                 id="tmdb-query"
                 name="q"
                 class="input join-item w-full"
                 placeholder="{% translate 'Search...' %}"
                 autocomplete="off"
                 hx-get="{% url 'tmdb_search_htmx' %}{% if media_id %}?media_id={{ media_id }}{% endif %}"
                 hx-trigger="keyup changed delay:400ms, search"
                 hx-target="#import-results"
                 hx-include="#tmdb-lang"
                 hx-indicator="#search-spinner" />
          <button type="button"
                  class="btn btn-primary join-item"
                  hx-get="{% url 'tmdb_search_htmx' %}{% if media_id %}?media_id={{ media_id }}{% endif %}"
                  hx-include="#tmdb-query, #tmdb-lang"
                  hx-target="#import-results"
                  hx-indicator="#search-spinner">{% lucide "search" %}</button>
        </div>
        <div class="flex items-center gap-2">
          <label for="tmdb-lang" class="text-sm text-base-content/70">{% translate "Metadata language:" %}</label>
          <select id="tmdb-lang" name="lang" class="select select-sm select-bordered">
            <option value="en-US" selected>English</option>
            <option value="fr-FR">Fran&ccedil;ais</option>
            <option value="de-DE">Deutsch</option>
            <option value="es-ES">Espa&ntilde;ol</option>
            <option value="it-IT">Italiano</option>
            <option value="pt-PT">Portugu&ecirc;s</option>
            <option value="ja-JP">&#26085;&#26412;&#35486;</option>
          </select>
        </div>
      </div>
    </div>
    {# IGDB Search (Video games) #}
    <div id="source-igdb" class="card bg-base-200 shadow-md mb-6 hidden">
      <div class="card-body p-4 space-y-3">
        <div class="flex items-center gap-2 mb-2">
          {% lucide "gamepad-2" class="w-5 h-5" %}
          <span class="font-semibold">IGDB</span>
          <span class="text-sm opacity-70">- {% translate "Video games" %}</span>
        </div>
        <div class="join w-full">
          <input type="text"
                 id="igdb-query"
                 name="q"
                 class="input join-item w-full"
                 placeholder="{% translate 'Search...' %}"
                 autocomplete="off"
                 hx-get="{% url 'igdb_search_htmx' %}{% if media_id %}?media_id={{ media_id }}{% endif %}"
                 hx-trigger="keyup changed delay:400ms, search"
                 hx-target="#import-results"
                 hx-indicator="#search-spinner" />
          <button type="button"
                  class="btn btn-primary join-item"
                  hx-get="{% url 'igdb_search_htmx' %}{% if media_id %}?media_id={{ media_id }}{% endif %}"
                  hx-include="#igdb-query"
                  hx-target="#import-results"
                  hx-indicator="#search-spinner">{% lucide "search" %}</button>
        </div>
      </div>
    </div>
    {# OpenLibrary Search (Books) #}
    <div id="source-openlibrary"
         class="card bg-base-200 shadow-md mb-6 hidden">
      <div class="card-body p-4 space-y-3">
        <div class="flex items-center gap-2 mb-2">
          {% lucide "book-open" class="w-5 h-5" %}
          <span class="font-semibold">OpenLibrary</span>
          <span class="text-sm opacity-70">- {% translate "Books" %}</span>
        </div>
        <div class="join w-full">
          <input type="text"
                 id="openlibrary-query"
                 name="q"
                 class="input join-item w-full"
                 placeholder="{% translate 'Search...' %}"
                 autocomplete="off"
                 hx-get="{% url 'openlibrary_search_htmx' %}{% if media_id %}?media_id={{ media_id }}{% endif %}"
                 hx-trigger="keyup changed delay:400ms, search"
                 hx-target="#import-results"
                 hx-indicator="#search-spinner" />
          <button type="button"
                  class="btn btn-primary join-item"
                  hx-get="{% url 'openlibrary_search_htmx' %}{% if media_id %}?media_id={{ media_id }}{% endif %}"
                  hx-include="#openlibrary-query"
                  hx-target="#import-results"
                  hx-indicator="#search-spinner">{% lucide "search" %}</button>
        </div>
      </div>
    </div>
    {# MusicBrainz Search (Music) #}
    <div id="source-musicbrainz"
         class="card bg-base-200 shadow-md mb-6 hidden">
      <div class="card-body p-4 space-y-3">
        <div class="flex items-center gap-2 mb-2">
          {% lucide "disc-3" class="w-5 h-5" %}
          <span class="font-semibold">MusicBrainz</span>
          <span class="text-sm opacity-70">- {% translate "Music albums" %}</span>
        </div>
        <div class="join w-full">
          <input type="text"
                 id="musicbrainz-query"
                 name="q"
                 class="input join-item w-full"
                 placeholder="{% translate 'Search...' %}"
                 autocomplete="off"
                 hx-get="{% url 'musicbrainz_search_htmx' %}{% if media_id %}?media_id={{ media_id }}{% endif %}"
                 hx-trigger="keyup changed delay:400ms, search"
                 hx-target="#import-results"
                 hx-indicator="#search-spinner" />
          <button type="button"
                  class="btn btn-primary join-item"
                  hx-get="{% url 'musicbrainz_search_htmx' %}{% if media_id %}?media_id={{ media_id }}{% endif %}"
                  hx-include="#musicbrainz-query"
                  hx-target="#import-results"
                  hx-indicator="#search-spinner">{% lucide "search" %}</button>
        </div>
      </div>
    </div>
    {# Loading indicator #}
    <div id="search-spinner" class="htmx-indicator text-center py-8">
      <span class="loading loading-spinner loading-lg"></span>
    </div>
    {# Results #}
    <div id="import-results"></div>
    {# Manual entry link #}
    <div class="text-center mt-8">
      <p class="text-base-content/70 mb-2">{% translate "Can't find what you're looking for?" %}</p>
      <a href="{% if media_id %}{% url 'media_edit' media_id %}{% else %}{% url 'media_add' %}{% endif %}"
         class="btn btn-outline btn-sm">
        {% lucide "square-pen" class="w-4 h-4" %}
        {% translate "Add manually" %}
      </a>
    </div>
  </div>
{% endblock content %}
